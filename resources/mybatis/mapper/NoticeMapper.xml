<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.house.team.board.dao.NoticeMapper">
	
	<!-- 목록 조회 -->
	 <select id="selectNoticeList" resultType="NoticeVO">
        SELECT *
        FROM (
            SELECT ROWNUM AS rn, n.*
            FROM (
                SELECT *
                FROM BOARDS_NOTICE
                WHERE DEL_YN = 'N'
                <if test="searchField != null and keyword != null and keyword != ''">
                    <choose>
                        <when test="searchField == 'title'">
                            AND NOTICE_TITLE LIKE '%' || #{keyword} || '%'
                        </when>
                        <when test="searchField == 'content'">
                            AND NOTICE_TEXT LIKE '%' || #{keyword} || '%'
                        </when>
                        <otherwise>
                            AND (NOTICE_TITLE LIKE '%' || #{keyword} || '%'
                             OR NOTICE_TEXT LIKE '%' || #{keyword} || '%')
                        </otherwise>
                    </choose>
                </if>
                <choose>
                    <when test="sort == 'views'">
                        ORDER BY VIEW_CNT DESC
                    </when>
                    <otherwise>
                        ORDER BY CREATE_DT DESC
                    </otherwise>
                </choose>
            ) n
        )
        WHERE rn &gt; #{offset} AND rn &lt;= #{offset} + #{size}
    </select>

    <!-- -->
    <select id="getNoticeCount" resultType="int">
        SELECT COUNT(*)
        FROM BOARDS_NOTICE
        WHERE DEL_YN = 'N'
        <if test="keyword != null and keyword != ''">
            <choose>
		    <when test="searchField == 'title'">
		      AND NOTICE_TITLE LIKE '%' || #{keyword} || '%'
		    </when>
		    <when test="searchField == 'content'">
		      AND NOTICE_TEXT LIKE '%' || #{keyword} || '%'
		    </when>
		    <when test="searchField == 'title_content'">
		      AND (NOTICE_TITLE LIKE '%' || #{keyword} || '%' OR NOTICE_TEXT LIKE '%' || #{keyword} || '%')
		    </when>
		    <otherwise>
		      AND (NOTICE_TITLE LIKE '%' || #{keyword} || '%' OR NOTICE_TEXT LIKE '%' || #{keyword} || '%')
		    </otherwise>
		  </choose>
        </if>
    </select>
    
    <!-- 상세 조회 -->
    <select id="getNoticeById" resultType="NoticeVO" parameterType="int">
        SELECT * FROM BOARDS_NOTICE WHERE NOTICE_NO = #{noticeNo} AND DEL_YN = 'N'
    </select>
    
    <!-- 조회수 증가 -->
    <update id="incrementViewCnt" parameterType="int">
        UPDATE BOARDS_NOTICE
        SET VIEW_CNT = VIEW_CNT + 1
        WHERE NOTICE_NO = #{noticeNo}
    </update>
    
</mapper>