<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.house.team.admin.dao.IAdminMemberDAO">
	
	<!-- 가입한 회원 리스트-->
	<select id="selectMemberList" resultType="AdminMemberVO">
	    SELECT *
	    FROM (
	        SELECT ROWNUM AS rn, n.*
	        FROM (
	            SELECT *
	            FROM MEMBERS
	            <where> <if test="searchField != null and keyword != null and keyword != ''">
	                    <choose>
	                        <when test="searchField == 'nickname'">
	                            NICKNAME LIKE '%' || #{keyword} || '%'
	                        </when>
	                        <when test="searchField == 'memEmail'">
	                            MEM_EMAIL LIKE '%' || #{keyword} || '%'
	                        </when>
	                        <when test="searchField == 'all'">
	                            (NICKNAME LIKE '%' || #{keyword} || '%' OR MEM_EMAIL LIKE '%' || #{keyword} || '%')
	                        </when>
	                    </choose>
	                </if>
	            </where>
	            ORDER BY CREATE_DT DESC) n
	    )
	    WHERE rn &gt; #{offset} AND rn &lt;= #{offset} + #{size}
	</select>
	
	<!-- 키워드별 검색 결과-->
	<select id="getMemberCount" resultType="int">
	    SELECT COUNT(*)
	    FROM members
	    <where>
	    	<if test="searchField != null and keyword != null and keyword != ''"> <choose>
	                <when test="searchField == 'nickname'">
	                    NICKNAME LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchField == 'memEmail'">
	                    MEM_EMAIL LIKE '%' || #{keyword} || '%'
	                </when>
	                <when test="searchField == 'all'">
	                    (NICKNAME LIKE '%' || #{keyword} || '%' OR MEM_EMAIL LIKE '%' || #{keyword} || '%')
	                </when>
	            </choose>
	        </if>
	    </where>
    </select>
	
	<!-- 상세 정보 -->
	<select id="getMemNo" parameterType="int" resultType="AdminMemberVO">
		SELECT s.MEM_NO, s.MEM_ID, s.MEM_PW,
	           m.MEM_EMAIL, m.NICKNAME, m.CREATE_DT, m.UPDATE_DT, m.USE_YN,
	           m.USER_TYPE, m.APT_NAME, m.DONG_NO, m.ROOM_NO, m.cmpx_cd
		FROM MEMBERS m
		INNER JOIN SOCIAL_LOGIN s ON m.MEM_NO = s.MEM_NO
		WHERE s.MEM_NO= #{memNo}
	</select>
	
	<!-- 건물 즐겨찾기 정보 -->
	<select id="selectMemBM" parameterType="int" resultType="MemberBookmarkVO">
        SELECT b.CMPX_CD, a.CMPX_NM, b.DEL_YN
        FROM BOOKMARK_CMPX b
        INNER JOIN APT_INFO a ON a.CMPX_CD = b.CMPX_CD
        WHERE b.MEM_NO = #{memNo}
        ORDER BY CMPX_CD, CMPX_NM
    </select>
	
</mapper>