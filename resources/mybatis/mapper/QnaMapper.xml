<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.house.team.board.dao.QnaMapper">
	
<select id="getQnaList" resultType="com.house.team.board.vo.QnaVO">
    SELECT
        q.*,
        m.nickname
    FROM
        BOARDS_QNA q
    LEFT JOIN
        MEMBERS m ON q.MEM_NO = m.MEM_NO
    WHERE
        q.DEL_YN = 'N'
    <if test="searchField != null and keyword != null">
        <choose>
            <when test="searchField == 'title'">
                AND q.Q_TITLE LIKE '%' || #{keyword} || '%'
            </when>
            <when test="searchField == 'text'">
                AND q.Q_TEXT LIKE '%' || #{keyword} || '%'
            </when>
            <otherwise>
                AND (q.Q_TITLE LIKE '%' || #{keyword} || '%' OR q.Q_TEXT LIKE '%' || #{keyword} || '%')
            </otherwise>
        </choose>
    </if>
    ORDER BY q.CREATE_DT DESC
</select>
	
	<select id="getQnaCount" resultType="int">
		SELECT COUNT(*) FROM BOARDS_QNA
        WHERE DEL_YN = 'N'
        <if test="searchField != null and keyword != null">
            <choose>
                <when test="searchField == 'title'">
                    AND Q_TITLE LIKE '%' || #{keyword} || '%'
                </when>
                <when test="searchField == 'text'">
                    AND Q_TEXT LIKE '%' || #{keyword} || '%'
                </when>
                <otherwise>
                    AND (Q_TITLE LIKE '%' || #{keyword} || '%' OR Q_TEXT LIKE '%' || #{keyword} || '%')
                </otherwise>
            </choose>
        </if>
	</select>
	
	<insert id="insertQna" parameterType="com.house.team.board.vo.QnaVO" useGeneratedKeys="true" keyProperty="boardNo" keyColumn="BOARD_NO">
    INSERT INTO BOARDS_QNA (
        MEM_NO, Q_TITLE, Q_TEXT, POST_PW, CREATE_DT,
        COMM_STATE, RATE, DEL_YN
    ) VALUES (
        #{memNo},
        #{qTitle},
        #{qText},
        #{postPw},
        SYSDATE,
        '답변 대기',
        0,
        'N'
    )
</insert>
	
	<select id="selectQnaByBoardNo" parameterType="int" resultType="com.house.team.board.vo.QnaVO">
    	SELECT *
    	FROM BOARDS_QNA
    	WHERE BOARD_NO = #{boardNo}
	</select>
	
	<update id="correctionQna" parameterType="com.house.team.board.vo.QnaVO">
	    UPDATE BOARDS_QNA
	    SET Q_TITLE = #{qTitle},
	        Q_TEXT = #{qText},
	        POST_PW = #{postPw},
	        UPDATE_DT = SYSDATE
	    WHERE BOARD_NO = #{boardNo}
	</update>
	
	<update id="deleteQna" parameterType="int">
	    UPDATE BOARDS_QNA
	    SET DEL_YN = 'Y', UPDATE_DT = SYSDATE
	    WHERE BOARD_NO = #{boardNo}
	</update>
	
	<!-- 조회수 증가 -->
    <update id="incrementRateCnt" parameterType="int">
        UPDATE BOARDS_QNA
        SET RATE = RATE + 1
        WHERE BOARD_NO = #{BOARD_NO}
    </update>

</mapper>