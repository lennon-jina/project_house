<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.house.team.board.dao.NewsMapper">

    <!-- ì „ì²´ ë‰´ìŠ¤ íŽ˜ì´ì§• -->
    <select id="selectNewsPage" resultType="com.house.team.board.vo.NewsVO">
        SELECT * FROM BOARDS_NEWS 
        ORDER BY UPLOAD_DT DESC
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <select id="selectNewsCount" resultType="int">
        SELECT COUNT(*) FROM BOARDS_NEWS
    </select>

    <!-- ì¹´í…Œê³ ë¦¬ ë‰´ìŠ¤ íŽ˜ì´ì§• -->
    <select id="selectNewsByCategoryPage" parameterType="map" resultType="com.house.team.board.vo.NewsVO">
        SELECT * FROM BOARDS_NEWS 
        WHERE CAT = #{category}
        ORDER BY UPLOAD_DT DESC
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <select id="countNewsByCategory" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM BOARDS_NEWS 
        WHERE CAT = #{category}
    </select>

    <!-- ðŸ” í‚¤ì›Œë“œ + ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ë‰´ìŠ¤ ê²€ìƒ‰ íŽ˜ì´ì§• -->
    <select id="searchNewsPage" parameterType="map" resultType="com.house.team.board.vo.NewsVO">
        <![CDATA[
		    SELECT * FROM (
		      SELECT A.*, ROWNUM RNUM FROM (
		        SELECT * FROM BOARDS_NEWS
		        WHERE 1=1
		  ]]>
		  
		  <if test="searchField == 'title'">
		    <![CDATA[
		      AND NEWS_TITLE LIKE '%' || #{keyword} || '%'
		    ]]>
		  </if>
		  <if test="searchField == 'content'">
		    <![CDATA[
		      AND NEWS_TEXT LIKE '%' || #{keyword} || '%'
		    ]]>
		  </if>
		  <if test="searchField == '' or searchField == null">
		    <![CDATA[
		      AND (NEWS_TITLE LIKE '%' || #{keyword} || '%' OR NEWS_TEXT LIKE '%' || #{keyword} || '%')
		    ]]>
		  </if>
		
		  <if test="category != null and category != ''">
		    <![CDATA[
		      AND CAT = #{category}
		    ]]>
		  </if>
		
		  <![CDATA[
		        ORDER BY UPLOAD_DT DESC
		      ) A
		      WHERE ROWNUM <= #{endRow}
		    )
		    WHERE RNUM > #{offset}
		  ]]>
    </select>

    <select id="countSearchNews" parameterType="map" resultType="int">
	  SELECT COUNT(*) FROM BOARDS_NEWS
	  WHERE 1 = 1
	
	  <!-- ì¹´í…Œê³ ë¦¬ ì¡°ê±´ -->
	  <if test="category != null and category != ''">
	    AND CAT = #{category}
	  </if>
	
	  <!-- ê²€ìƒ‰ ì¡°ê±´ -->
	  <choose>
	    <when test="searchField == 'title'">
	      AND NEWS_TITLE LIKE '%' || #{keyword} || '%'
	    </when>
	    <when test="searchField == 'content'">
	      AND NEWS_TEXT LIKE '%' || #{keyword} || '%'
	    </when>
	    <when test="searchField == 'title_content'">
	      AND (NEWS_TITLE LIKE '%' || #{keyword} || '%' OR NEWS_TEXT LIKE '%' || #{keyword} || '%')
	    </when>
	    <otherwise>
	      AND (NEWS_TITLE LIKE '%' || #{keyword} || '%' OR NEWS_TEXT LIKE '%' || #{keyword} || '%')
	    </otherwise>
	  </choose>
	</select>
	<!-- ë‰´ìŠ¤ ìƒì„¸ ì •ë³´-->
	<select id="selectedNewsById" parameterType="long" resultType="com.house.team.board.vo.NewsVO">
		SELECT NEWS_NO, CAT, NEWS_TITLE, NEWS_TEXT, UPLOAD_DT, NEWS_IMG, WRITER, NEWS_URL, DEL_YN
        FROM BOARDS_NEWS
        WHERE NEWS_NO = #{newsNo}
        AND DEL_YN = 'N'
	</select>
	<!-- ì¡°íšŒìˆ˜ ì¦ê°€ -->
    <update id="incrementViewCnt" parameterType="int">
        UPDATE BOARDS_NEWS
        SET VIEW_CNT = VIEW_CNT + 1
        WHERE NEWS_NO = #{NEWS_NO}
    </update>
</mapper>